package behaviours;

import jade.core.Agent;
import jade.core.behaviours.CyclicBehaviour;
import jade.core.behaviours.ParallelBehaviour;
import jade.lang.acl.ACLMessage;
import jade.lang.acl.MessageTemplate;
import agents.BiddingAgent;
import dao.domain.Annoucement;
import data.Annoucements;

/**
 * Odbiór wiadomosci od MorrisColumn przez BiddingAgent
 * 
 * @author Kasia
 *
 */

public class ReceiveMessageBiddingFromMorris extends CyclicBehaviour {

	/**
	 * 
	 */
	private static final long serialVersionUID = 6022152552104135291L;
	private MessageTemplate mt;
	private BiddingAgent a;
	private ParallelBehaviour parentBehaviour;

	public ReceiveMessageBiddingFromMorris(Agent a, MessageTemplate mt,
			ParallelBehaviour parentB) {
		super(a);
		this.a = (BiddingAgent) a;
		this.mt = mt;
		this.parentBehaviour = parentB;
	}

	@Override
	public void action() {

		ACLMessage msg = a.receive(mt);
		if (msg == null) {
			block();
			return;
		}

		/*
		 * sprawdzanie czy to odpowiedz - na podbicie aukcji (czyli
		 * accept/decline) - wy wyszukanie aukcji (informative)
		 */
		try {
			Object content = msg.getContentObject();
			switch (msg.getPerformative()) {
			/* aukcje */
			case (ACLMessage.REQUEST):

				Annoucements announces = (Annoucements) content;

				if (announces != null) {
					a.setMyAnnoces(announces);
					System.out.println("ODBIOR od MORRISA - "
							+ myAgent.getLocalName() + " <- "
							+ msg.getSender().getLocalName() + " "
							+ "licytuje:");

					for (Annoucement a : announces.getAnnoucements()) {
						System.out.println(" - " + "id: " + a.getId()
								+ " typ: " + a.getType() + " cena: "
								+ a.getCurrentPrice());

					}
					a.sendBidMsgToMorris();
				}else{
					System.out.println("Puste announce");
				}

				/* wybierz i podbij */
				break;

			case (ACLMessage.ACCEPT_PROPOSAL):
				System.out.println("ODBIOR od MORRISA - "
						+ myAgent.getLocalName() + " <- "
						+ msg.getSender().getLocalName()
						+ " udalo mi sie podbic aukcje " + msg.getContent());

				break;

			case (ACLMessage.REJECT_PROPOSAL):

				/* szukaj kolejna do podpbicia */
				System.out
						.println("ODBIOR od MORRISA - "
								+ myAgent.getLocalName() + " <- "
								+ msg.getSender().getLocalName()
								+ " nie udalo mi sie podbic aukcje "
								+ msg.getContent());

				break;
			}

		} catch (Exception e) {
			e.printStackTrace();
			System.out.println("Nie udalo sie odebrac wiadomosci");
		}

	}

}
